define("tool_wsmanager/actions",["exports","core_form/modalform","core/str","core_reportbuilder/local/events","core_reportbuilder/local/selectors","core/event_dispatcher","core/ajax","core/notification","core/modal_cancel"],(function(_exports,_modalform,_str,reportEvents,reportSelectors,_event_dispatcher,_ajax,_notification,_modal_cancel){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Actions for webservice manager tool.
   *
   * @module     tool_wsmanager/actions
   * @copyright  Marina Glancy
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=function(){var _bulkForm$closest;document.addEventListener("click",(event=>{const editServices=event.target.closest(SELECTORS_EDITSERVICES);editServices&&(event.preventDefault(),showFunctionModalForm(editServices,(0,_str.getString)("editservices","tool_wsmanager"),"tool_wsmanager\\form\\function_services_form"));const editDescription=event.target.closest(SELECTORS_EDITDESCRIPTION);editDescription&&(event.preventDefault(),showFunctionModalForm(editDescription,(0,_str.getString)("editdetails","tool_wsmanager"),"tool_wsmanager\\form\\edit_function_form"));const viewDetails=event.target.closest(SELECTORS_viewDetails);viewDetails&&(event.preventDefault(),async function(targetElement){const functionname=targetElement.dataset.function,paramsDesc=hightlighInJson(targetElement.dataset.parametersDesc),title1=await(0,_str.getString)("functionparameters","tool_wsmanager"),returnDesc=hightlighInJson(targetElement.dataset.returnDesc),title2=await(0,_str.getString)("functionreturns","tool_wsmanager");await _modal_cancel.default.create({title:functionname,large:!0,removeOnClose:!0,returnElement:targetElement,show:!0,body:"<p><strong>"+title1+":</strong></p><pre>"+paramsDesc+"</pre><p><strong>"+title2+":</strong></p><pre>"+returnDesc+"</pre>"})}(viewDetails))}));const bulkForm=document.querySelector(SELECTORS_bulkActionsForm),reportElement=null==bulkForm||null===(_bulkForm$closest=bulkForm.closest(SELECTORS_reportWrapper))||void 0===_bulkForm$closest?void 0:_bulkForm$closest.querySelector(reportSelectors.regions.report);if(bulkForm&&reportElement){const actionSelect=bulkForm.querySelector("select");actionSelect.addEventListener("change",(event=>{event.preventDefault();const value=event.target.value;if("0"!==value){const functionNames=[...reportElement.querySelectorAll(SELECTORS_checkedRows)].map((v=>v.value));event.target.value="0",functionNames.length>0&&async function(actionSelect,reportElement,actionValue,functionNames){var arr=actionValue.match(/^(add|remove)-service-(\d+)$/);if(arr){const request={methodname:"tool_wsmanager_add_function_to_service",args:{functionnames:functionNames,serviceid:parseInt(arr[2]),action:arr[1]}};_ajax.default.call([request])[0].then((()=>((0,_event_dispatcher.dispatchEvent)(reportEvents.tableReload,{preservePagination:!0},reportElement),null))).catch((e=>_notification.default.exception(e)))}"add-tag"==actionValue&&showTagsModalForm(actionSelect,reportElement,{functionnames:functionNames.join(","),action:"add"},(0,_str.getString)("addtag","tool_wsmanager"));"remove-tag"==actionValue&&showTagsModalForm(actionSelect,reportElement,{functionnames:functionNames.join(","),action:"remove"},(0,_str.getString)("removetag","tool_wsmanager"))}(actionSelect,reportElement,value,functionNames)}}))}},_modalform=_interopRequireDefault(_modalform),reportEvents=_interopRequireWildcard(reportEvents),reportSelectors=_interopRequireWildcard(reportSelectors),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification),_modal_cancel=_interopRequireDefault(_modal_cancel);const SELECTORS_EDITSERVICES='[data-action="tool_wsmanager-edit-services"][data-function]',SELECTORS_EDITDESCRIPTION='[data-action="tool_wsmanager-edit-description"][data-function]',SELECTORS_viewDetails='[data-action="tool_wsmanager-view-details"][data-function]',SELECTORS_bulkActionsForm="form#tool_wsmanager-bulk-actions-form",SELECTORS_reportWrapper='[data-region="tool_wsfunction-list-wrapper"]',SELECTORS_checkedRows='[data-togglegroup="report-select-all"][data-toggle="slave"]:checked';function showFunctionModalForm(targetElement,title,formClass){const functionname=targetElement.dataset.function,modalForm=new _modalform.default({modalConfig:{title:title},formClass:formClass,args:{functionname:functionname},saveButtonText:(0,_str.getString)("savechanges","moodle"),returnFocus:targetElement}),reportElement=targetElement.closest(reportSelectors.regions.report);modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(()=>{(0,_event_dispatcher.dispatchEvent)(reportEvents.tableReload,{preservePagination:!0},reportElement)})),modalForm.show()}function showTagsModalForm(actionSelect,reportElement,args,title){const modalForm=new _modalform.default({modalConfig:{title:title},formClass:"tool_wsmanager\\form\\change_tags_form",args:args,saveButtonText:(0,_str.getString)("savechanges","moodle"),returnFocus:actionSelect});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(()=>{(0,_event_dispatcher.dispatchEvent)(reportEvents.tableReload,{preservePagination:!0},reportElement)})),modalForm.show()}function hightlighInJson(jsonString){if(!jsonString)return"";const doHighlight=function(v){let parentKey=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("object"==typeof v&&null!==v){const v2={};for(const key of Object.keys(v)){const newKey="keys"===parentKey?'<strong class="key">'+key+"</strong>":key,newValue="desc"===key?'<strong class="desc">'+v[key]+"</strong>":doHighlight(v[key],key);v2[newKey]=newValue}return v2}return v},value=JSON.parse(jsonString),newValue=doHighlight(value,null);return JSON.stringify(newValue,null,2)}}));

//# sourceMappingURL=actions.min.js.map